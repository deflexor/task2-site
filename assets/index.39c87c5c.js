var e,t,n,i,r,a,s,o,d,h;n=RegExp("^[+]?[0-9]{1,4}[-]?[0-9]{3}[-]?[0-9]{3}[-]?[0-9]{2}[-]?[0-9]{2}$"),s=function(e){var t,n,i,r,a;for(r={},t=0,i=e.length;t<i;t++)[n,a]=e[t],r[n]=a;return r},o=new Backbone.LocalStorage("UserStore"),r=Backbone.Model.extend({localStorage:o,defaults:{name:"",phone:""},validate:function(e,t){var i,r;return(r=function(){var t,n,r,a;for(a=[],t=0,n=(r=["name","phone"]).length;t<n;t++)e[i=r[t]]||a.push([i,`Не зполнено поле: ${i}`]);return a}()).length>0?r:n.test(e.phone)?void 0:[["phone","Телефон указан некорректно"]]}}),a=Backbone.Collection.extend({model:r,localStorage:o,modelId:function(e){return e.id}}),i=Backbone.View.extend({initialize:function(){this.edit=!1,this.model.on("change",this.render,this),this.model.on("destroy",this.remove,this)},tagName:"tr",template:_.template($("#item-template").html()),render:function(e=this.model,t={}){return this.$el.html(this.template(_.extend({edit:this.edit,err:t},e.attributes))),this},events:{"keypress .input":"updateOnEnter","click .cancel":"close","click .edit":"edit","click .save":"save","click .destroy":"destroy"},edit:function(){var e;this.edit=!0,this.render(),(e=this.el.querySelector("input"))&&e.focus()},updateOnEnter:function(e){13===e.which&&this.save()},close:function(){this.edit=!1,this.render()},save:function(){var e,t,n,i,a;[n,i]=function(){var e,n,i,r;for(r=[],e=0,n=(i=["name","phone"]).length;e<n;e++)t=i[e],r.push(this.el.querySelector(`[name=${t}]`).value);return r}.call(this),(a=new r).set({name:n,phone:i},{silent:!0}),a.isValid()?(this.model.set(a.attributes),this.model.save(),this.edit=!1,this.render()):(e=a.validationError,this.render(a,s(e)))},destroy:function(e){return this.model.destroy()}}),e=Backbone.View.extend({initialize:function(){this.edit=!1},el:"#add-row",template:_.template($("#addrow-template").html()),render:function(e={}){return this.$el.html(this.template(_.extend({edit:this.edit,err:e},this.model.attributes))),this},events:{"keypress .input":"updateOnEnter","click .add":"edit","click .save":"save","click .cancel":"cancel"},edit:function(){var e;this.edit=!0,this.render(),(e=this.el.querySelector("input"))&&e.focus()},cancel:function(){this.edit=!1,this.render(),this.model.set(this.model.defaults,{silent:!0})},updateOnEnter:function(e){13===e.which&&this.save()},save:function(){var e,t,n,i;[n,i]=function(){var e,n,i,r;for(r=[],e=0,n=(i=["name","phone"]).length;e<n;e++)t=i[e],r.push(this.el.querySelector(`[name=${t}]`).value);return r}.call(this),this.model.set({name:n,phone:i},{silent:!0}),this.model.isValid()?(this.model.save(),h.add(this.model),this.model=new r,this.edit=!1,this.render()):(e=this.model.validationError,this.render(s(e)))}}),t=Backbone.View.extend({el:"#app",initialize:async function(){return this.nodataTemplate=_.template($("#nodata-template").html()),$("#add-row").append(new e({model:new r}).render().el),h.on("add",this.addOne,this),h.on("remove",this.removeOne,this),h.on("sync",this.checkEmpty,this),await h.fetch()},addOne:function(e){var t,n,r;return n=document.getElementById("user-list"),(t=document.querySelector(".nodata"))&&n.removeChild(t),r=new i({model:e}),n.appendChild(r.render().el)},checkEmpty:function(){return 0===h.length&&($("#user-list").html(this.nodataTemplate()),!0)},removeOne:function(){return this.checkEmpty()},addAll:function(){var e,t,n,i,r;if(!this.checkEmpty()){for(i=[],e=0,t=(n=h.models).length;e<t;e++)r=n[e],i.push(this.addOne(r));return i}}}),h=new a,Backbone.history.start(),new t,0===o.findAll().length&&((d=[]).push({name:"John Doe",phone:"189998885555"}),d.push({name:"Super man",phone:"189995555555"}),d.push({name:"Supergirl",phone:"15555555555"}),d.push({name:"Spiderman",phone:"9999999999999"}),d.push({name:"Gerrard Rene",phone:"189998885555"}),d.forEach((function(e){var t;return(t=new r(e)).save({silent:!0}),h.add(t)})));
